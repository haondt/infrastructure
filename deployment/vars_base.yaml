x-shared:
  marble:
    cluster_ip: &marble_cluster_ip 192.168.1.100


terraform:
  default:
    backend_config: &tf_backend
      address: https://gitlab.com/api/v4/projects/68409780/terraform/state/default
      lock_address: https://gitlab.com/api/v4/projects/68409780/terraform/state/default/lock
      unlock_address: https://gitlab.com/api/v4/projects/68409780/terraform/state/default/lock
      lock_method: POST
      unlock_method: DELETE
      retry_wait_min: 5
    tfvars:
      cloudflare:
        domains:
  clusters:
    backend_config:
      <<: *tf_backend
      address: https://gitlab.com/api/v4/projects/68409780/terraform/state/clusters
      lock_address: https://gitlab.com/api/v4/projects/68409780/terraform/state/clusters/lock
      unlock_address: https://gitlab.com/api/v4/projects/68409780/terraform/state/clusters/lock
    tfvars:
      clusters:
        marble:
          cluster_ip: *marble_cluster_ip
          service_accounts:
            gitlab-deployments-runner:
            roles:
              - deployer



ssh:
  public_keys: &public_keys
    - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINjSDZ49g0G2wpeTUe66hT5/bNlHt37Z+gEg7JZf/67f haondt@aurora

ansible:
  inventory:
    k3s_clusters:
      children:
        marble:
          hosts:
            marble-1:
              ansible_host: 192.168.1.131
            marble-2:
              ansible_host: 192.168.1.175
            marble-3:
              ansible_host: 192.168.1.149
          vars:
            ansible_user: marble
            ansible_ssh_private_key_file: build/id_rsa
            k3s_version: v1.33.3+k3s1
            k3s_node_name: "{{ inventory_hostname }}"
            k3s_node_ip: "{{ ansible_host }}"
            k3s_cluster_ip:  *marble_cluster_ip
            k3s_cluster_control_plane_ip: "{{ k3s_cluster_ip }}"
            k3s_server_config_yaml: |
              node-ip: {{ ansible_host }}
              disable: traefik,servicelb
              flannel-backend: none
              disable-network-policy: true
              tls-san:
                - {{ k3s_cluster_control_plane_ip }}
            k3s_extra_server_args: "--secrets-encryption"
            kubernetes:
              cluster_ip: *marble_cluster_ip
              install_calico: true
              service_accounts:
                gitlab-deployments-runner:
                  roles:
                    - cluster-admin

  vars:
    ssh:
      public_keys: *public_keys

  group_vars: {}
