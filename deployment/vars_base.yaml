x-shared:
  marble:
    cluster_ip: &marble_cluster_ip 192.168.1.100
    ingress_ip: &marble_ingress_ip 192.168.1.101
    load_balancer_ip_range: &load_balancer_ip_range 192.168.1.101-192.168.1.110
    pod_cidr: &marble_pod_cidr 10.42.0.0/16

terraform:
  default:
    backend_config: &tf_backend
      address: https://gitlab.com/api/v4/projects/68409780/terraform/state/default
      lock_address: https://gitlab.com/api/v4/projects/68409780/terraform/state/default/lock
      unlock_address: https://gitlab.com/api/v4/projects/68409780/terraform/state/default/lock
      lock_method: POST
      unlock_method: DELETE
      retry_wait_min: 5
    tfvars:
      cloudflare:
        domains:

  clusters:
    backend_config:
      <<: *tf_backend
      address: https://gitlab.com/api/v4/projects/68409780/terraform/state/clusters
      lock_address: https://gitlab.com/api/v4/projects/68409780/terraform/state/clusters/lock
      unlock_address: https://gitlab.com/api/v4/projects/68409780/terraform/state/clusters/lock
    tfvars:
      clusters:
        marble:
          cluster_ip: *marble_cluster_ip
          service_accounts:
            gitlab-deployments-marble:
            roles:
              - deployer



ssh:
  public_keys: &public_keys
    - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINjSDZ49g0G2wpeTUe66hT5/bNlHt37Z+gEg7JZf/67f haondt@aurora

ansible:
  inventory:
    k3s_clusters:
      children:
        marble:
          hosts:
            marble-1:
              ansible_host: 192.168.1.131
            marble-2:
              ansible_host: 192.168.1.175
            marble-3:
              ansible_host: 192.168.1.149
          vars:
            ansible_user: marble
            ansible_ssh_private_key_file: build/id_rsa
            k3s_version: v1.33.3+k3s1
            k3s_node_name: "{{ inventory_hostname }}"
            k3s_node_ip: "{{ ansible_host }}"
            k3s_cluster_ip:  *marble_cluster_ip
            k3s_pod_cidr: *marble_pod_cidr
            k3s_cluster_control_plane_ip: "{{ k3s_cluster_ip }}"
            k3s_server_config_yaml: |
              node-ip: "{{ ansible_host }}"
              disable: servicelb,traefik
              flannel-backend: none
              disable-network-policy: true
              disable-cloud-controller: true
              cluster-cidr: "{{ k3s_pod_cidr }}"
              tls-san:
                - "{{ k3s_cluster_control_plane_ip }}"
            k3s_extra_server_args: "--secrets-encryption"
            kubernetes:
              kubeconfig: "~/.kube/config"
              context: "marble"
              cluster_ip: *marble_cluster_ip
              calico:
                enabled: true
                pod_cidr: *marble_pod_cidr
              metallb:
                enabled: true
                ip_address_pool:
                  global:
                    - *load_balancer_ip_range
              kube_vip_cloud_controller:
                enabled: false
                ip_address_ranges:
                  global:
                    range: *load_balancer_ip_range
              ingress_nginx:
                load_balancer_ip: *marble_ingress_ip
                enabled: true
                node_port:
                  enabled: false
                  http: 30080
                  https: 30443
              cert_manager:
                enabled: true
              service_accounts:
                gitlab-deployments-marble:
                  roles:
                    - cluster-admin

  vars:
    ssh:
      public_keys: *public_keys

  group_vars: {}
