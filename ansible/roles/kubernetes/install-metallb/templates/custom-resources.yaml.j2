{% for pool_name, addresses in kubernetes.metallb.ip_address_pool.items() %}
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: {{ pool_name }}
  namespace: metallb-system
  labels:
    infra.haondt.dev/managed-by: ansible
spec:
  addresses:
{% for address in addresses %}
  - {{ address }}
{% endfor %}
{% endfor %}

---
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  labels:
    infra.haondt.dev/managed-by: ansible
  name: default
  namespace: metallb-system
