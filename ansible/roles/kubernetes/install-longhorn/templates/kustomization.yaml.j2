apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - https://raw.githubusercontent.com/longhorn/longhorn/{{ kubernetes.longhorn.version }}/deploy/longhorn.yaml

commonLabels:
  infra.haondt.dev/managed-by: ansible

patches:
  - target:
      kind: ConfigMap
      name: longhorn-default-setting
      namespace: longhorn-system
    patch: |-
        - op: replace
          path: /data/default-setting.yaml
          value: |
              priority-class: longhorn-critical
              disable-revision-counter: true
{% if kubernetes.longhorn.default_data_path is defined %}
              default-data-path: {{ kubernetes.longhorn.default_data_path }}
{% endif %}
              default-data-locality: best-effort
